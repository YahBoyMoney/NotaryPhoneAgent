<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notary Voice Agent</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Twilio Client JS SDK - Required for browser calling -->
    <script type="text/javascript" src="https://sdk.twilio.com/js/client/v1.14/twilio.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">Notary Voice Agent</h4>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="index.html">
                                <i class="fas fa-home me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="calls.html">
                                <i class="fas fa-phone me-2"></i>Calls
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="clients.html">
                                <i class="fas fa-users me-2"></i>Clients
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1>Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button id="makeCallBtn" type="button" class="btn btn-sm btn-primary me-2">
                            <i class="fas fa-phone me-1"></i> Make Call
                        </button>
                        <button id="sendMessageBtn" type="button" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-comment me-1"></i> Send Message
                        </button>
                    </div>
                </div>
                
                <!-- Dashboard content -->
                <div class="row">
                    <!-- Stats cards -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-primary shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                            Calls Today</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">12</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-phone fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-success shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                            Active Clients</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">38</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-users fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-info shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                            Pending Documents</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">5</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-file-alt fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-warning shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                            Appointments Today</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">3</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent activity and upcoming appointments -->
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Recent Activity</h6>
                                <a href="#" class="btn btn-sm btn-primary">View All</a>
                            </div>
                            <div class="card-body">
                                <div class="activity-item d-flex mb-3">
                                    <div class="activity-icon bg-primary text-white rounded-circle">
                                        <i class="fas fa-phone"></i>
                                    </div>
                                    <div class="activity-content ms-3">
                                        <span class="fw-bold">Call with John Doe</span>
                                        <p class="text-muted small mb-0">Discussed mortgage document notarization</p>
                                        <small class="text-muted">Today, 10:30 AM</small>
                                    </div>
                                </div>
                                <div class="activity-item d-flex mb-3">
                                    <div class="activity-icon bg-success text-white rounded-circle">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="activity-content ms-3">
                                        <span class="fw-bold">Document Notarized</span>
                                        <p class="text-muted small mb-0">Real estate deed for Sarah Johnson</p>
                                        <small class="text-muted">Yesterday, 3:45 PM</small>
                                    </div>
                                </div>
                                <div class="activity-item d-flex mb-3">
                                    <div class="activity-icon bg-info text-white rounded-circle">
                                        <i class="fas fa-comment"></i>
                                    </div>
                                    <div class="activity-content ms-3">
                                        <span class="fw-bold">Message Sent</span>
                                        <p class="text-muted small mb-0">Appointment reminder to Michael Brown</p>
                                        <small class="text-muted">Yesterday, 1:20 PM</small>
                                    </div>
                                </div>
                                <div class="activity-item d-flex">
                                    <div class="activity-icon bg-warning text-white rounded-circle">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <div class="activity-content ms-3">
                                        <span class="fw-bold">Appointment Scheduled</span>
                                        <p class="text-muted small mb-0">New appointment with Emily Davis</p>
                                        <small class="text-muted">2 days ago, 11:15 AM</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Upcoming Appointments</h6>
                                <a href="#" class="btn btn-sm btn-primary">Add New</a>
                            </div>
                            <div class="card-body">
                                <div class="appointment-item d-flex justify-content-between align-items-center mb-3 p-2 border-bottom">
                                    <div>
                                        <span class="fw-bold">Sarah Johnson</span>
                                        <p class="text-muted small mb-0">Real Estate Deed</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-primary">Today, 2:00 PM</span>
                                        <div class="btn-group btn-group-sm mt-1">
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-phone"></i></button>
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-comment"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="appointment-item d-flex justify-content-between align-items-center mb-3 p-2 border-bottom">
                                    <div>
                                        <span class="fw-bold">Michael Brown</span>
                                        <p class="text-muted small mb-0">Power of Attorney</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-primary">Today, 4:30 PM</span>
                                        <div class="btn-group btn-group-sm mt-1">
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-phone"></i></button>
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-comment"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="appointment-item d-flex justify-content-between align-items-center p-2">
                                    <div>
                                        <span class="fw-bold">Emily Davis</span>
                                        <p class="text-muted small mb-0">Affidavit</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-secondary">Tomorrow, 10:15 AM</span>
                                        <div class="btn-group btn-group-sm mt-1">
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-phone"></i></button>
                                            <button type="button" class="btn btn-outline-secondary"><i class="fas fa-comment"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Call Modal -->
    <div class="modal fade" id="callModal" tabindex="-1" aria-labelledby="callModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="callModalLabel">Make a Call</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="callForm">
                        <div class="mb-3">
                            <label for="clientSelect" class="form-label">Select Client</label>
                            <select class="form-select" id="clientSelect">
                                <option value="" selected>Select a client or type a name</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="phoneNumber" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="phoneNumber" placeholder="Enter phone number (e.g., +12125551234)">
                            <small class="form-text text-muted">Format: +1 (country code) followed by 10-digit number</small>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="recordCall" checked>
                            <label class="form-check-label" for="recordCall">Record Call</label>
                        </div>
                        <div class="mb-3">
                            <label for="callNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="callNotes" rows="3" placeholder="Enter any notes about this call"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="startCallBtn">Start Call</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Message Modal -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageModalLabel">Send Message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="messageForm">
                        <div class="mb-3">
                            <label for="messageClientSelect" class="form-label">Select Client</label>
                            <select class="form-select" id="messageClientSelect">
                                <option value="" selected>Select a client or type a name</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="messagePhoneNumber" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="messagePhoneNumber" placeholder="Enter phone number (e.g., +12125551234)">
                            <small class="form-text text-muted">Format: +1 (country code) followed by 10-digit number</small>
                        </div>
                        <div class="mb-3">
                            <label for="messageText" class="form-label">Message</label>
                            <textarea class="form-control" id="messageText" rows="4" placeholder="Enter your message"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="sendSMSBtn">Send Message</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Custom JS -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    
    <!-- Integration scripts -->
    <script src="js/integrations/twilio.js"></script>
    <script src="js/integrations/elevenlabs.js"></script>
    <script src="js/integrations/notary-agent.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize the integrations
            NotaryVoiceAgent.init();
            
            // Load sample clients for demo
            loadSampleClients();
            
            // Set up event listeners
            $('#makeCallBtn').on('click', function() {
                $('#callModal').modal('show');
            });
            
            $('#sendMessageBtn').on('click', function() {
                $('#messageModal').modal('show');
            });
            
            $('#startCallBtn').on('click', function() {
                const phoneNumber = $('#phoneNumber').val();
                const notes = $('#callNotes').val();
                const recordCall = $('#recordCall').is(':checked');
                
                if (!phoneNumber) {
                    alert('Please enter a phone number');
                    return;
                }
                
                const options = {
                    recording: recordCall,
                    notes: notes
                };
                
                try {
                    // Start the call using Notary Voice Agent
                    const callResult = NotaryVoiceAgent.startCall(phoneNumber, options);
                    
                    if (callResult) {
                        console.log('Call initiated successfully');
                        // Close the modal
                        $('#callModal').modal('hide');
                        
                        // Display calling status message
                        alert('Call initiated. Note: This is using a mock implementation and will not ring real phones unless connected to a real Twilio account.');
                    } else {
                        console.error('Failed to initiate call');
                        alert('Failed to initiate call. Please check the phone number and try again.');
                    }
                } catch (error) {
                    console.error('Error initiating call:', error);
                    alert('Error initiating call: ' + (error.message || 'Unknown error'));
                    // Ensure modal closes even on error
                    $('#callModal').modal('hide');
                }
            });
            
            $('#sendSMSBtn').on('click', function() {
                const phoneNumber = $('#messagePhoneNumber').val();
                const message = $('#messageText').val();
                
                if (!phoneNumber) {
                    alert('Please enter a phone number');
                    return;
                }
                
                if (!message) {
                    alert('Please enter a message');
                    return;
                }
                
                // Send the SMS using Notary Voice Agent
                NotaryVoiceAgent.sendMessage(phoneNumber, message);
                
                // Close the modal
                $('#messageModal').modal('hide');
            });
            
            // Handle client selection change
            $('#clientSelect').on('change', function() {
                const clientId = $(this).val();
                if (clientId) {
                    const clients = JSON.parse(localStorage.getItem('clients') || '[]');
                    const client = clients.find(c => c.id === clientId);
                    if (client) {
                        $('#phoneNumber').val(client.phone);
                    }
                }
                // Enable manual editing of the phone number field
                $('#phoneNumber').prop('readonly', false);
            });
            
            $('#messageClientSelect').on('change', function() {
                const clientId = $(this).val();
                if (clientId) {
                    const clients = JSON.parse(localStorage.getItem('clients') || '[]');
                    const client = clients.find(c => c.id === clientId);
                    if (client) {
                        $('#messagePhoneNumber').val(client.phone);
                    }
                }
                // Enable manual editing of the phone number field
                $('#messagePhoneNumber').prop('readonly', false);
            });
            
            // Ensure phone number inputs are always editable
            $('#phoneNumber, #messagePhoneNumber').on('focus', function() {
                $(this).prop('readonly', false);
            });
            
            // Load sample clients function
            function loadSampleClients() {
                // Check if we already have clients stored
                const existingClients = localStorage.getItem('clients');
                if (existingClients) {
                    // Clients exist, populate the dropdowns
                    populateClientDropdowns(JSON.parse(existingClients));
                    return;
                }
                
                // Sample client data
                const sampleClients = [
                    {
                        id: 'client-1',
                        name: 'John Doe',
                        email: 'john.doe@example.com',
                        phone: '+12125551234',
                        address: '123 Main St, New York, NY 10001',
                        status: 'Active',
                        notes: 'Regular client, prefers morning appointments'
                    },
                    {
                        id: 'client-2',
                        name: 'Sarah Johnson',
                        email: 'sarah.j@example.com',
                        phone: '+13105557890',
                        address: '456 Oak Ave, Los Angeles, CA 90001',
                        status: 'Active',
                        notes: 'Real estate agent, often needs quick turnaround'
                    },
                    {
                        id: 'client-3',
                        name: 'Michael Brown',
                        email: 'mbrown@example.com',
                        phone: '+17735551212',
                        address: '789 Park Rd, Chicago, IL 60601',
                        status: 'Inactive',
                        notes: 'Last appointment was 3 months ago'
                    }
                ];
                
                // Store sample clients in local storage
                localStorage.setItem('clients', JSON.stringify(sampleClients));
                
                // Populate client dropdowns
                populateClientDropdowns(sampleClients);
            }
            
            // Populate client dropdowns
            function populateClientDropdowns(clients) {
                const clientSelect = $('#clientSelect');
                const messageClientSelect = $('#messageClientSelect');
                
                clients.forEach(client => {
                    const option = `<option value="${client.id}">${client.name} (${client.phone})</option>`;
                    clientSelect.append(option);
                    messageClientSelect.append(option);
                });
            }
            
            // Set up Notary Voice Agent listeners
            NotaryVoiceAgent.addListener(function(source, data) {
                console.log('Notary Voice Agent event:', source, data);
                
                if (source === 'twilio') {
                    handleTwilioEvent(data.event, data.data);
                } else if (source === 'elevenlabs') {
                    // Handle ElevenLabs events if needed
                }
            });
            
            // Handle Twilio events
            function handleTwilioEvent(event, data) {
                switch (event) {
                    case 'deviceReady':
                        console.log('Twilio device is ready for calls');
                        break;
                    
                    case 'connected':
                        console.log('Call connected:', data);
                        // Display a clearer message that this is a mock call
                        if (data.mock) {
                            alert('MOCK CALL ACTIVE: This is a simulated call and will not ring actual phones.');
                        }
                        break;
                    
                    case 'disconnected':
                        console.log('Call disconnected:', data);
                        alert('Call ended');
                        break;
                    
                    case 'error':
                        console.error('Twilio error:', data.message);
                        alert('Error: ' + data.message);
                        break;
                    
                    case 'smsSent':
                        console.log('SMS sent:', data);
                        alert('Message sent successfully!');
                        break;
                }
            }
        });
    </script>
</body>
</html> 